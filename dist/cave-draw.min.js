/*
 *
 * Add a draw board to your comment form
 *
 * V0.0.4
 *
 * Copyright (C) flatblowfish
 * Github:   https://github.com/flatblowfish
 * Website:  https://blog.maplesugar.top
 *
 */
"use strict";var CaveDraw=function(){var t=/mobile/i.test(window.navigator.userAgent),g={isMobile:t,pixelRatio:window.devicePixelRatio,nameMap:{dragStart:t?"touchstart":"mousedown",dragMove:t?"touchmove":"mousemove",dragEnd:t?"touchend":"mouseup"},domLoad:function(t){document.addEventListener("DOMContentLoaded",t)},find:function(t,n){return t.querySelector(n)},insertAfter:function(t,n){var e=t.parentNode;e.lastChild==t?e.appendChild(n):e.insertBefore(n,t.nextElementSibling)}},b=void 0,m=!1,x=!1,n=!1,i=!1,f="black",y=2*g.pixelRatio,w=!1,E=20*g.pixelRatio,k=5*g.pixelRatio,e=function(){this.option=Array.prototype.shift.call(arguments),this.init()};return e.prototype.init=function(){var t=this;t.option.special&&"valine"==t.option.special&&(x=!0,t.submitProxy()),g.domLoad(function(){(b=document.querySelector(t.option.ele))&&(t.option.formEle&&""!=t.option.formEle&&(m=!0),t.getDom(),t.UIEvent(),t.draw(),m&&(t.formEle=document.querySelector(t.option.formEle),t.send()))})},e.prototype.getDom=function(){var t=document.createElement("div");t.innerHTML='\n        <style>\n        .clearfix::after {\n            content: "";\n            display: block;\n            height: 0;\n            visibility: hidden;\n            clear: both;\n        }\n\n        .cd-container {\n            position: relative;\n            width: 100%;\n            height: 34px;\n            margin-top: 5px;\n        }\n\n        .cd-open {\n            float: left;\n            width: 80px;\n            height: 30px;\n            margin-top: 2px;\n            font-size: 15px;\n            color: white;\n            background-color: #b37ba4;\n            border-radius: 4px;\n            border: none;\n            cursor: pointer;\n            transition: all .2s linear;\n        }\n\n        .cd-open:hover {\n            background-color: #49d0c0;\n        }\n\n        .cd-toolbar {\n            display: none;\n            position: relative;\n            float: right;\n            height: 34px;\n            border-radius: 3px;\n            box-shadow: 0 1px 2px 0 rgba(32, 33, 36, 0.28);\n            background: #fff;\n        }\n\n        .cd-toolbar button {\n            width: 30px;\n            height: 30px;\n            margin: 2px 6px;\n            border: none;\n            background-size: 20px 20px;\n            background-position: center center;\n            background-repeat: no-repeat;\n            background-color: #fff;\n            cursor: pointer;\n            border: 2px solid transparent;\n            border-radius: 4px;\n            transition: all .2s linear;\n        }\n\n        .cd-toolbar button.cd-brush {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M273.6 957.056a25.6 25.6 0 0 1-18.112-7.488l-180.992-180.992a25.6 25.6 0 0 1 0-36.224L798.528 8.256a25.6 25.6 0 0 1 36.224 0l180.992 180.992a25.6 25.6 0 0 1 0 36.224L291.712 949.568a25.6 25.6 0 0 1-18.112 7.488z m-144.832-206.656l144.832 144.832L961.472 207.36 816.64 62.528 128.768 750.4z" p-id="2160"></path><path d="M26.304 1023.296a25.6 25.6 0 0 1-24.768-32.192l66.24-247.296a25.6 25.6 0 0 1 42.816-11.456l180.992 180.992a25.6 25.6 0 0 1-11.456 42.816L32.832 1022.4a26.048 26.048 0 0 1-6.656 0.896z m79.552-223.424l-43.328 161.6 161.6-43.264-118.272-118.336zM736.704 106.24l180.992 180.992-54.336 54.336-180.992-180.992 54.336-54.336zM332.416 653.824a25.6 25.6 0 0 1-18.112-43.712l271.552-271.488a25.6 25.6 0 0 1 36.224 36.224l-271.552 271.488a25.472 25.472 0 0 1-18.112 7.488z"></path></svg>\');\n        }\n\n        .cd-toolbar button.cd-eraser {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M978.817649 939.233112H522.995705l476.613823-476.613823c12.795002-12.795002 20.791878-33.58688 20.791878-55.978133s-7.996876-38.385006-20.791878-55.978134L673.336978 22.791097c-30.38813-30.38813-76.770012-30.38813-107.158142 0L84.766888 504.203046c-110.356892 110.356892-110.356892 294.285045 0 404.641936l30.38813 30.38813c55.978134 55.978134 127.95002 84.766888 204.720031 84.766888h662.141351c25.590004 0 43.183132-17.593128 43.183131-43.183132s-20.791878-41.583756-46.381882-41.583756z m-361.458805-847.668879l315.076923 315.076923-366.256931 366.256931-315.076923-315.076923L617.358844 91.564233zM143.943772 849.668098c-76.770012-76.770012-76.770012-204.720031 0-284.688793l46.381882-46.381882L507.001952 832.074971l-46.381882 46.381882c-38.385006 38.385006-89.565014 59.176884-140.745021 59.176884-55.978134 0-107.158141-20.791878-145.543147-59.176884L143.943772 849.668098z"></path></svg>\');\n        }\n\n        .cd-toolbar button.cd-clear {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6c-0.3 1.5-0.4 3-0.4 4.4 0 14.4 11.6 26 26 26h723c1.5 0 3-0.1 4.4-0.4 14.2-2.4 23.7-15.9 21.2-30zM204 390h272V182h72v208h272v104H204V390z m468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"></path></svg>\');\n            background-size: 24px 24px;\n        }\n\n        .cd-toolbar button.cd-undo {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M596.676923 248.123077c204.8 0 372.184615 165.415385 372.184615 372.184615s-167.384615 372.184615-372.184615 372.184616h-161.476923c-15.753846 0-25.6-11.815385-25.6-27.569231v-63.015385c0-15.753846 11.815385-29.538462 27.569231-29.538461h159.507692c139.815385 0 252.061538-112.246154 252.061539-252.061539s-112.246154-252.061538-252.061539-252.061538H322.953846s-15.753846 0-21.661538 1.969231c-15.753846 7.876923-11.815385 19.692308 1.96923 33.476923l96.492308 96.492307c11.815385 11.815385 9.846154 29.538462-1.969231 41.353847L354.461538 584.861538c-11.815385 11.815385-25.6 11.815385-37.415384 1.969231l-256-256c-9.846154-9.846154-9.846154-25.6 0-35.446154L315.076923 41.353846c11.815385-11.815385 31.507692-11.815385 41.353846 0l41.353846 41.353846c11.815385 11.815385 11.815385 31.507692 0 41.353846l-96.492307 96.492308c-11.815385 11.815385-11.815385 25.6 7.876923 25.6h13.784615l273.723077 1.969231z" fill="lightgray"></path></svg>\');\n        }\n\n        .cd-toolbar button.cd-redo {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M699.076923 246.153846h13.784615c19.692308 0 19.692308-13.784615 7.876924-25.6l-96.492308-96.492308c-11.815385-9.846154-11.815385-29.538462 0-41.353846l41.353846-41.353846c9.846154-11.815385 29.538462-11.815385 41.353846 0L960.984615 295.384615c9.846154 9.846154 9.846154 25.6 0 35.446154l-256 256c-11.815385 9.846154-25.6 9.846154-37.415384-1.969231l-43.323077-43.323076c-11.815385-11.815385-13.784615-29.538462-1.969231-41.353847l96.492308-96.492307c13.784615-13.784615 17.723077-25.6 1.969231-33.476923-5.907692-1.969231-21.661538-1.969231-21.661539-1.969231H425.353846c-139.815385 0-252.061538 112.246154-252.061538 252.061538s112.246154 252.061538 252.061538 252.061539h159.507692c15.753846 0 27.569231 13.784615 27.569231 29.538461V964.923077c0 15.753846-9.846154 27.569231-25.6 27.569231h-161.476923C220.553846 992.492308 53.169231 827.076923 53.169231 620.307692s167.384615-372.184615 372.184615-372.184615l273.723077-1.969231z" fill="lightgray"></path></svg>\');\n        }\n\n        .cd-toolbar button.cd-undo.active {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M596.676923 248.123077c204.8 0 372.184615 165.415385 372.184615 372.184615s-167.384615 372.184615-372.184615 372.184616h-161.476923c-15.753846 0-25.6-11.815385-25.6-27.569231v-63.015385c0-15.753846 11.815385-29.538462 27.569231-29.538461h159.507692c139.815385 0 252.061538-112.246154 252.061539-252.061539s-112.246154-252.061538-252.061539-252.061538H322.953846s-15.753846 0-21.661538 1.969231c-15.753846 7.876923-11.815385 19.692308 1.96923 33.476923l96.492308 96.492307c11.815385 11.815385 9.846154 29.538462-1.969231 41.353847L354.461538 584.861538c-11.815385 11.815385-25.6 11.815385-37.415384 1.969231l-256-256c-9.846154-9.846154-9.846154-25.6 0-35.446154L315.076923 41.353846c11.815385-11.815385 31.507692-11.815385 41.353846 0l41.353846 41.353846c11.815385 11.815385 11.815385 31.507692 0 41.353846l-96.492307 96.492308c-11.815385 11.815385-11.815385 25.6 7.876923 25.6h13.784615l273.723077 1.969231z"></path></svg>\');\n            border-color: transparent;\n        }\n\n        .cd-toolbar button.cd-redo.active {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M699.076923 246.153846h13.784615c19.692308 0 19.692308-13.784615 7.876924-25.6l-96.492308-96.492308c-11.815385-9.846154-11.815385-29.538462 0-41.353846l41.353846-41.353846c9.846154-11.815385 29.538462-11.815385 41.353846 0L960.984615 295.384615c9.846154 9.846154 9.846154 25.6 0 35.446154l-256 256c-11.815385 9.846154-25.6 9.846154-37.415384-1.969231l-43.323077-43.323076c-11.815385-11.815385-13.784615-29.538462-1.969231-41.353847l96.492308-96.492307c13.784615-13.784615 17.723077-25.6 1.969231-33.476923-5.907692-1.969231-21.661538-1.969231-21.661539-1.969231H425.353846c-139.815385 0-252.061538 112.246154-252.061538 252.061538s112.246154 252.061538 252.061538 252.061539h159.507692c15.753846 0 27.569231 13.784615 27.569231 29.538461V964.923077c0 15.753846-9.846154 27.569231-25.6 27.569231h-161.476923C220.553846 992.492308 53.169231 827.076923 53.169231 620.307692s167.384615-372.184615 372.184615-372.184615l273.723077-1.969231z"></path></svg>\');\n            border-color: transparent;\n        }\n\n        .cd-toolbar button.cd-save {\n            background-image: url(\'data:image/svg+xml;utf8,<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="160" height="160"><path d="M829 856H195a4 4 0 0 0-4 4v64a4 4 0 0 0 4 4h634a4 4 0 0 0 4-4v-64a4 4 0 0 0-4-4z m22.2-376H676.6V112a16 16 0 0 0-16-16H363.4a16 16 0 0 0-16 16v368H172.8c-15 0-21.7 18.9-10.1 28.4l339.2 277.3a16 16 0 0 0 20.2 0l339.2-277.3c11.6-9.5 4.9-28.4-10.1-28.4zM512 701L329.8 552h89.6V168h185.2v384h89.6z"></path></svg>\');\n            background-size: 24px 24px;\n        }\n\n        .cd-toolbar button.active {\n            border-color: #1398E6;\n        }\n\n        .cd-toolbar .brush-detail {\n            display: none;\n            position: absolute;\n            box-sizing: content-box;\n            top: -150px;\n            left: 0;\n            width: 226px;\n            height: 108px;\n            padding: 16px 16px;\n            border: 1px solid #81A4BD;\n            border-radius: 5px;\n            color: #808FA2;\n            font-style: 18px;\n            background: #fff;\n            font-size: 14px;\n        }\n\n        .brush-detail.active {\n            display: block;\n        }\n\n        .brush-detail p {\n            margin-top: 0px;\n            margin-bottom: 4px !important;\n        }\n\n        .brush-detail .brush-color div {\n            position: relative;\n            float: left;\n            width: 30px;\n            height: 30px;\n            border-radius: 50%;\n            cursor: pointer;\n        }\n\n        .brush-detail .brush-color div.active::before {\n            position: absolute;\n            box-sizing: border-box;\n            left: 3px;\n            top: 3px;\n            content: \'\';\n            display: block;\n            width: 24px;\n            height: 24px;\n            background: transparent;\n            border: 2px solid #fff;\n            border-radius: 50%;\n        }\n\n        .brush-detail .brush-color div+div {\n            margin-left: 8px;\n        }\n\n        .brush-detail .circle-box {\n            position: relative;\n            width: 24px;\n            height: 24px;\n            display: inline-block;\n            text-align: center;\n            margin-right: 8px;\n            margin-left: 3px;\n        }\n\n        .brush-detail .circle-box .thickness {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            width: 24px;\n            height: 24px;\n            margin-left: -12px;\n            margin-top: -12px;\n            background: #000;\n            border-radius: 50%;\n            /* transform-origin: center; */\n        }\n\n        .brush-detail input[type=range] {\n            -webkit-appearance: none;\n            width: 180px;\n            height: 24px;\n            outline: none !important;\n            border: none !important;\n            padding: 0 !important;\n        }\n\n        .brush-detail input[type=\'range\']::-webkit-slider-runnable-track {\n            background-color: #DBDBDB;\n            height: 4px;\n            border-radius: 5px;\n        }\n\n        .brush-detail input[type=\'range\']::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            /* border: 5px solid #fff; */\n            width: 12px;\n            height: 12px;\n            border-radius: 50%;\n            background: #FF4081;\n            cursor: pointer;\n            margin-top: -4px;\n        }\n\n        #cave-canvas {\n            display: none;\n            margin-top: 10px;\n        }\n\n        @media screen and (max-width: 768px) {\n            .cd-toolbar button {\n                margin: 2px 3px;\n            }\n\n            .cd-toolbar .brush-detail {\n                top: -134px;\n                left: -8px;\n                padding: 8px 8px;\n            }\n        }\n        </style>\n        \n        <div class="cd-container clearfix">\n            <button class="cd-open" id="cd-open" title="打开画板" type="button">打开画板</button>\n            <div class="cd-toolbar" id="cd-toolbar">\n                <button class="cd-brush active" id="cd-brush" title="画笔" type="button"></button>\n                <div class="brush-detail" id="brushDetail">\n                    <p>画笔大小</p>\n                    <div class="">\n                        <span class="circle-box"><i class="thickness" id="thickness"></i></span>\n                        <input type="range" id="brushLineWidthRange" min="1" max="20" value="6">\n                    </div>\n                    <p>画笔颜色</p>\n                    <div class="brush-color clearfix">\n                        <div class="brush-color-item active" style="background-color: black;"></div>\n                        <div class="brush-color-item" style="background-color: #FF3333;"></div>\n                        <div class="brush-color-item" style="background-color: #99CC00;"></div>\n                        <div class="brush-color-item" style="background-color: #0066FF;"></div>\n                        <div class="brush-color-item" style="background-color: #FFFF33;"></div>\n                        <div class="brush-color-item" style="background-color: #33CC66;"></div>\n                    </div>\n                </div>\n                <button class="cd-eraser" id="cd-eraser" title="橡皮擦" type="button"></button>\n                <button class="cd-clear" id="cd-clear" title="清屏" type="button"></button>\n                <button class="cd-undo"  id="cd-undo" title="撤销" type="button"></button>\n                <button class="cd-redo"  id="cd-redo" title="再做" type="button"></button>\n                <button class="cd-save"  id="cd-save" title="保存" type="button"></button>\n            </div>\n        </div>\n        <canvas id="cave-canvas">\n            <div>\n                <a href="https://github.com/flatblowfish/cave-draw" target="_blank">Cave Draw</a> Powered by <a href="https://blog.maplesugar.top" target="_blank">枫糖</a>\n                <h3>如果您看到这段文字，说明您的浏览器不支持Canvas。</h3>\n            </div>\n        </canvas>\n        <style>.cd-open{'+this.option.openBtn.style+"}.cd-open:hover{"+this.option.openBtn.hoverStyle+"}</style>",g.insertAfter(b,t),this.openBtn=document.getElementById("cd-open"),this.canvasEle=document.getElementById("cave-canvas"),this.context=this.canvasEle.getContext("2d"),this.toolBarEle=document.getElementById("cd-toolbar"),this.brushBtn=document.getElementById("cd-brush"),this.eraserBtn=document.getElementById("cd-eraser"),this.clearBtn=document.getElementById("cd-clear"),this.undoBtn=document.getElementById("cd-undo"),this.redoBtn=document.getElementById("cd-redo"),this.saveBtn=document.getElementById("cd-save"),this.brushDetail=document.getElementById("brushDetail"),this.brushLineWidthRange=document.getElementById("brushLineWidthRange"),this.thickness=document.getElementById("thickness"),this.brushColorEle=document.getElementsByClassName("brush-color-item")},e.prototype.UIEvent=function(){var a=this,o=function(){w?(a.brushBtn.classList.remove("active"),a.eraserBtn.classList.add("active")):(a.brushBtn.classList.add("active"),a.eraserBtn.classList.remove("active")),i?a.brushDetail.classList.add("active"):a.brushDetail.classList.remove("active")};this.openBtn.addEventListener("click",function(){n?(a.toolBarEle.style.display="none",a.canvasEle.style.display="none"):(a.toolBarEle.style.display="block",a.canvasEle.style.display="block"),n=!n}),this.brushBtn.addEventListener("click",function(){w=!1,i=!i,o()});document.addEventListener(g.nameMap.dragStart,function(t){if(i){var n=a.brushDetail,e=t.target;e!=a.brushBtn&&(n.contains(e)||(i=!i,o()))}});var t=function(){a.thickness.style.transform="scale("+a.brushLineWidthRange.value/20+")",y=parseInt(a.brushLineWidthRange.value)*g.pixelRatio};t(),this.brushLineWidthRange.addEventListener("input",t);!function(){for(var t=0;t<a.brushColorEle.length;t++)a.brushColorEle[t].addEventListener("click",function(t){for(var n=0;n<a.brushColorEle.length;n++)a.brushColorEle[n].classList.remove("active");this.classList.add("active"),f=this.style.backgroundColor,a.context.fillStyle=f,a.context.strokeStyle=f,a.thickness.style.background=f})}();this.eraserBtn.addEventListener("click",function(){w=!0,o()})},e.prototype.draw=function(){var o=this;o.canvasEle.style=o.option.canvasStyle;var n=function(){var t=o.context.getImageData(0,0,o.canvasEle.width,o.canvasEle.height),n=b.offsetWidth,e=b.offsetWidth/3<300?300:b.offsetWidth/3;o.canvasEle.width=n*g.pixelRatio,o.canvasEle.height=e*g.pixelRatio,o.context.putImageData(t,0,0),o.canvasEle.style.width=n+"px",o.canvasEle.style.height=e+"px",o.context.lineCap="round",o.context.lineJoin="round"};n(),window.addEventListener("resize",n),new ResizeObserver(function(t){n()}).observe(b);var e=function(t){return g.isMobile?{x:(t.touches[0].clientX-o.canvasEle.getBoundingClientRect().left)*g.pixelRatio,y:(t.touches[0].clientY-o.canvasEle.getBoundingClientRect().top)*g.pixelRatio}:{x:t.offsetX*g.pixelRatio,y:t.offsetY*g.pixelRatio}};function i(t,n){o.context.save(),o.context.beginPath(),o.context.arc(t,n,E/2+1,0,2*Math.PI),o.context.clip(),o.context.clearRect(0,0,o.canvasEle.width,o.canvasEle.height),o.context.restore()}function r(t,n,e,a){o.context.beginPath(),o.context.lineWidth=y,o.context.strokeStyle=f,o.context.moveTo(t,n),o.context.lineTo(e,a),o.context.stroke(),o.context.closePath()}function a(t,n){var e,a;w?(i(t.x,t.y),e=n.x,a=n.y,o.context.save(),o.context.lineWidth=k,o.context.strokeStyle="rgb(252,150,148)",o.context.beginPath(),o.context.arc(e,a,E/2,0,2*Math.PI),o.context.clip(),o.context.stroke(),o.context.restore()):r(t.x,t.y,n.x,n.y)}var c,s,l;c=!1,s={x:void 0,y:void 0},l={x:void 0,y:void 0},o.canvasEle.addEventListener(g.nameMap.dragStart,function(t){var n;t.preventDefault(),c=!0,s=e(t),n=s,w?i(n.x,n.y):r(n.x,n.y,n.x,n.y)}),o.canvasEle.addEventListener(g.nameMap.dragMove,function(t){t.preventDefault(),c&&(l=e(t),a(s,l),s=l)}),o.canvasEle.addEventListener(g.nameMap.dragEnd,function(t){var n;t.preventDefault(),c=!1,n=s,w&&i(n.x,n.y),p()});o.canvasHistory=[];var d=0,u=function(e){if(m||x)o.canvasEle.toBlob(function(t){var n=URL.createObjectURL(t);o.canvasHistory.push(n),e&&e()},"image/png",1);else{var t=o.canvasEle.toDataURL("image/png");o.canvasHistory.push(t),e&&e()}},t=function(t){o.canvasHistory=[],d=0,u(t)};t();var h=function(){0<d?o.undoBtn.classList.add("active"):o.undoBtn.classList.remove("active"),d<o.canvasHistory.length-1?o.redoBtn.classList.add("active"):o.redoBtn.classList.remove("active")};this.clearBtn.addEventListener("click",function(){o.context.clearRect(0,0,o.canvasEle.width,o.canvasEle.height),t(function(){v(o.canvasHistory[d]),h()})});var v=function(t){var n='<img id="cave-img" alt="画板图片，请勿删除" src="'+t+'" />',e=/\<img id="cave-img".*\>/g;e.test(b.value)?b.value=b.value.replace(e,n):""==b.value?b.value=n:b.value=b.value+"\n"+n,g.isMobile||b.focus()},p=function(){d<o.canvasHistory.length-1&&(o.canvasHistory.length=d+1),d++,u(function(){v(o.canvasHistory[d]),h()})};this.undoBtn.addEventListener("click",function(){!function(){if(0<d){d--;var t=new Image;t.onload=function(){o.context.clearRect(0,0,o.canvasEle.width,o.canvasEle.height),o.context.drawImage(t,0,0),v(t.src)},t.src=o.canvasHistory[d]}h()}()}),this.redoBtn.addEventListener("click",function(){!function(){if(d<o.canvasHistory.length-1){d++;var t=new Image;t.onload=function(){o.context.clearRect(0,0,o.canvasEle.width,o.canvasEle.height),o.context.drawImage(t,0,0),v(t.src)},t.src=o.canvasHistory[d]}h()}()}),this.saveBtn.addEventListener("click",function(){var t=o.canvasEle.toDataURL("image/png"),n=document.createElement("a");document.body.appendChild(n),n.href=t,n.download="cave-draw-"+(new Date).getTime(),n.target="_blank",n.click()})},e.prototype.send=function(){var e=this;this.formEle.addEventListener("submit",function(t){var n='<img id="cave-img" src="'+e.canvasEle.toDataURL("image/png")+'" />';b.value=b.value.replace(/\<img id="cave-img".*\>/g,n)})},e.prototype.submitProxy=function(){var o=this;Element.prototype._addEventListener=Element.prototype.addEventListener,Element.prototype.addEventListener=function(t,n,e){null==e&&(e=!1);var a=n;this===document.querySelector(".vsubmit")&&"click"===t&&(a=function(){var t='<img id="cave-img" src="'+o.canvasEle.toDataURL("image/png")+'" />';b.value=b.value.replace(/\<img id="cave-img".*\>/g,t),b.focus(),b.blur(),n()}),this._addEventListener(t,a,e)}},e}();